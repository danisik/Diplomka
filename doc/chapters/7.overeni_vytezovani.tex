\lstset{style=sqlstyle}

%CHAPTER
\chapter{Ověření efektivního vytěžování}
K ověření efektivního vytěžování bylo připraveno několik scénářů jak pro SQL, tak i pro Mongo s využitím vyhledávače Elasticsearch.Z výsledků scénářů můžeme poté usoudit, jak moc efektivní vytěžování je vzhledem k technickým parametrům stroje a použitým technologiím.

\subsubsection{Testovací stroj - technické parametry}
Testovací stroj, který byl použit pro kontrolu efektivity vytěžování, má tyto technické parametry:
\begin{itemize}
\item \textbf{Procesor} - Intel(R) Core(TM) i5-8250U CPU @ 1.60GHz (8 CPUs).
\item \textbf{RAM} - 8192 MB
\item \textbf{Disk} - SSD 256 GB
\item \textbf{Grafická karta 1} - Intel(R) UHD Graphics 620
\item \textbf{Grafická karta 2} - NVIDIA GeForce 940MX
\item \textbf{Operační systém} - Windows 10 Home 64bit (10.0, build 19044).

\end{itemize}

\section{Mongo + ElasticSearch}
\todo{todo}

\section{MySQL} \label{sec:efektivni_vytezovani_sql}
Pro MySQL bylo připraveno devět scénářů, které testují všechny vytvořené tabulky v databázi. Každý scénář obsahuje textový popis, SQL příkaz, rychlost vykonání příkazu a ukázku výsledků. Každý scénář odpovídá jednomu pohledu v databázi.

\subsection{Scénář č.1}
\textbf{Textový popis}: Deset nejčastěji patentujících institucí v Izraeli v roce 2015.
\newline
\textbf{SQL}: 
\begin{lstlisting}[label = {lst:elements_a}]
select count(*), count(*) * 100.0 / ((select count(*) from inventors left outer join patents on inventors.id_patent = patents.id where YEAR(patents.patent_date) = 2015 and patents.patent_id like '%IL%') * 1.0) as percentage, inventors.inventor from inventors left outer join patents on inventors.id_patent = patents.id where YEAR(patents.patent_date) = 2015 and patents.patent_id like '%IL%' group by inventors.inventor order by count(*) desc, percentage desc LIMIT 10;
\end{lstlisting}
\textbf{Rychlost vykonání dotazu}:  +- 1,4 sekundy
\newline
\textbf{Výsledek dotazu}:
\begin{figure}[H]
\centering
\includegraphics[width=9cm]{img/scenare/scenar_1}
\caption{Ukázka výsledku dotazu pro scénář č.1}
\label{fig:scenar1}
\end{figure}


\subsection{Scénář č.2}
\textbf{Textový popis}: Tři nejméně patentované obory v Kanadě od roku 2010.
\newline
\textbf{SQL}: 
\begin{lstlisting}[label = {lst:elements_a}]
select count(*), count(*) * 100.0 / ((select count(*) from classification left outer join patents on patents.id = classification.id_patent where YEAR(patents.patent_date) >= 2010 and patents.patent_id like '%CA%') * 1.0) as percentage, classification.section from classification left outer join patents on patents.id = classification.id_patent where YEAR(patents.patent_date) >= 2010 and patents.patent_id like '%CA%' group by classification.section order by count(*) asc, percentage asc LIMIT 5;
\end{lstlisting}
\textbf{Rychlost vykonání dotazu}: +- 6,2 sekund
\newline
\textbf{Výsledek dotazu}:
\begin{figure}[H]
\centering
\includegraphics[width=5cm]{img/scenare/scenar_2}
\caption{Ukázka výsledku dotazu pro scénář č.2}
\label{fig:scenar2}
\end{figure}

\subsection{Scénář č.3}
\textbf{Textový popis}: Dvacet nejčastějších klasifikací patentů za rok 2008 ve Španělsku.
\newline
\textbf{SQL}:
\begin{lstlisting}[label = {lst:elements_a}]
select count(*), count(*) * 100.0 / ((select count(*) from classification left outer join patents on patents.id = classification.id_patent where YEAR(patents.patent_date) = 2008 and patents.patent_id LIKE '%ES%') * 1.0) as percentage, classification.section, classification.class, classification.subclass from classification left outer join patents on patents.id = classification.id_patent where YEAR(patents.patent_date) = 2008 and patents.patent_id LIKE '%ES%' group by classification.section, classification.class, classification.subclass order by count(*) desc, percentage desc LIMIT 20;
\end{lstlisting}
\textbf{Rychlost vykonání dotazu}: +- 1,3 sekundy
\newline
\textbf{Výsledek dotazu}:
\begin{figure}[H]
\centering
\includegraphics[width=7cm]{img/scenare/scenar_3}
\caption{Ukázka výsledku dotazu pro scénář č.3}
\label{fig:scenar3}
\end{figure}

\subsection{Scénář č.4} 
\textbf{Textový popis}: Deset autorů s největším počtem patentů ze všech zemí.
\newline
\textbf{SQL}: 
\begin{lstlisting}[label = {lst:elements_a}]
select count(*), count(*) * 100.0 / ((select count(*) from inventors) * 1.0) as percentage, inventors.inventor from inventors group by inventors.inventor order by count(*) desc, percentage desc LIMIT 10;
\end{lstlisting}
\textbf{Rychlost vykonání dotazu}: +- 8 sekund
\newline
\textbf{Výsledek dotazu}:
\begin{figure}[H]
\centering
\includegraphics[width=8cm]{img/scenare/scenar_4}
\caption{Ukázka výsledku dotazu pro scénář č.4}
\label{fig:scenar4}
\end{figure}

\subsection{Scénář č.5}
\textbf{Textový popis}: Pět nejméně používaných jazyků pro patenty za rok 2003.
\newline
\textbf{SQL}: 
\begin{lstlisting}[label = {lst:elements_a}]
select count(*), count(*) * 100.0 / ((select count(*) from patents where patents.language not like '%-%') * 1.0) as percentage, patents.language from patents where patents.language not like '%-%' group by patents.language order by count(*) asc, percentage asc LIMIT 5;
\end{lstlisting}
\textbf{Rychlost vykonání dotazu}: +- 5,3 sekund
\newline
\textbf{Výsledek dotazu}:
\begin{figure}[H]
\centering
\includegraphics[width=5cm]{img/scenare/scenar_5}
\caption{Ukázka výsledku dotazu pro scénář č.5}
\label{fig:scenar5}
\end{figure}

\subsection{Scénář č.6}
\textbf{Textový popis}: Deset Institucí / autorů s patenty pokrývající největší množství oborů ve Španělsku.
\newline
\textbf{SQL}: 
\begin{lstlisting}[label = {lst:elements_a}]
select count(distinct classification.section), count(*) * 100.0 / ((select count(*) from inventors left outer join classification on classification.id_patent = inventors.id_patent left outer join patents on patents.id = inventors.id_patent where section is not null and patents.country like '%ES%') * 1.0) as percentage, inventors.inventor from inventors left outer join classification on classification.id_patent = inventors.id_patent left outer join patents on patents.id = inventors.id_patent where section is not null and patents.country like '%ES%' group by inventors.inventor order by count(distinct classification.section) desc, percentage desc LIMIT 10;
\end{lstlisting}
\textbf{Rychlost vykonání dotazu}: +- 3 sekundy
\newline
\textbf{Výsledek dotazu}:
\begin{figure}[H]
\centering
\includegraphics[width=10cm]{img/scenare/scenar_6}
\caption{Ukázka výsledku dotazu pro scénář č.6}
\label{fig:scenar6}
\end{figure}

\subsection{Scénář č.7}
\textbf{Textový popis}: Pět zemí s nejvíce patenty od roku 2018.
\newline
\textbf{SQL}: 
\begin{lstlisting}[label = {lst:elements_a}]
select count(*), count(*) * 100.0 / ((select count(*) from patents where YEAR(patents.patent_date) >= 2018) * 1.0) as percentage, patents.country from patents where YEAR(patents.patent_date) >= 2018 group by patents.country order by count(*) desc, percentage desc LIMIT 5;
\end{lstlisting}
\textbf{Rychlost vykonání dotazu}: +- 2,4 sekundy
\newline
\textbf{Výsledek dotazu}:
\begin{figure}[H]
\centering
\includegraphics[width=5cm]{img/scenare/scenar_7}
\caption{Ukázka výsledku dotazu pro scénář č.7}
\label{fig:scenar7}
\end{figure}

\subsection{Scénář č.8}
\textbf{Textový popis}: Nejvíce používaný typ patentu ve Francii.
\newline
\textbf{SQL}: 
\begin{lstlisting}[label = {lst:elements_a}]
select count(*), count(*) * 100.0 / ((select count(*) from patents where patents.patent_id like '%FR%' and patents.kind not like '%-%') * 1.0) as percentage, patents.kind from patents where patents.patent_id like '%FR%' and patents.kind not like '%-%' group by patents.kind order by count(*) desc, percentage desc;
\end{lstlisting}
\textbf{Rychlost vykonání dotazu}: +- 5,5 sekund
\newline
\textbf{Výsledek dotazu}:
\begin{figure}[H]
\centering
\includegraphics[width=5cm]{img/scenare/scenar_8}
\caption{Ukázka výsledku dotazu pro scénář č.8}
\label{fig:scenar8}
\end{figure}

\subsection{Scénář č.9}
\textbf{Textový popis}: Patnáct nejčastěji patentujících institucí / autorů v Anglii v textilním oboru za rok 2013.
\newline
\textbf{SQL}: 
\begin{lstlisting}[label = {lst:elements_a}]
select count(*), count(*) * 100.0 / ((select count(*) from inventors left outer join patents on patents.id = inventors.id_patent left outer join classification on classification.id_patent = patents.id where classification.section like '%D%' and patents.patent_id like '%GB%' and YEAR(patents.patent_date) = 2013) * 1.0) as percentage, inventors.inventor from inventors left outer join patents on patents.id = inventors.id_patent left outer join classification on classification.id_patent = patents.id where classification.section like '%D%' and patents.patent_id like '%GB%' and YEAR(patents.patent_date) = 2013 group by inventors.inventor order by count(*) desc, percentage desc LIMIT 15;
\end{lstlisting}
\textbf{Rychlost vykonání dotazu}: +- 1,3 sekundy
\newline
\textbf{Výsledek dotazu}:
\begin{figure}[H]
\centering
\includegraphics[width=9cm]{img/scenare/scenar_9}
\caption{Ukázka výsledku dotazu pro scénář č.9}
\label{fig:scenar9}
\end{figure}